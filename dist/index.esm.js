import t,{useState as e,useEffect as a,useMemo as r,useInsertionEffect as n,createContext as s,useContext as i}from"react";var o,u;function l(t){return new Error(`"${t}" is not registered`)}!function(t){t[t.blur=0]="blur",t[t.instant=1]="instant"}(o||(o={})),o.instant,o.instant,function(t){t.INIT="INIT",t.NEW_VALUE="NEW_VALUE",t.BLURRED="BLURRED",t.NEW_FORCED_VALUE="NEW_FORCED_VALUE",t.SET_INPUT_ERROR="SET_INPUT_ERROR",t.CLEAN_INPUT_ERROR="CLEAN_INPUT_ERROR",t.SET_LOADING_ON="SET_LOADING_ON",t.SET_LOADING_OFF="SET_LOADING_OFF",t.SET_GLOBAL_ERROR="SET_GLOBAL_ERROR",t.CLEAR_GLOBAL_ERROR="CLEAR_GLOBAL_ERROR",t.SET_SUCCESS="SET_SUCCESS",t.ASYNC_VALIDATION="ASYNC_VALIDATION"}(u||(u={}));class c{time;__select_time;constructor(t=800){this.time=t,this.__select_time=0}cb(t){this.reset(),this.__select_time=setTimeout((()=>{t&&t()}),this.time)}reset(){clearTimeout(this.__select_time)}}function d(t,e){switch(e.type){case u.SET_LOADING_ON:t.formState.loading=!0;break;case u.SET_LOADING_OFF:t.formState.loading=!1;break;case u.CLEAR_GLOBAL_ERROR:t.formState.formStatus="CLEAN",t.formState.error=null;break;case u.SET_GLOBAL_ERROR:t.formState.formStatus="GLOBAL-ERROR",t.formState.formAttemptGlobalError++,t.formState.error=e.payload;break;case u.CLEAN_INPUT_ERROR:t.inputStates[e.payload.name].error=null,"GLOBAL-ERROR"!==t.formState.formStatus&&Object.values(t.inputStates).reduce(((t,e)=>t&&e))&&(t.formState.formStatus="CLEAN");break;case u.SET_INPUT_ERROR:if(e.payload.name){const a=t.inputStates[e.payload.name];a.error=e.payload,a.validateLoading=!1}break;case u.NEW_FORCED_VALUE:{const a=e.payload,r=a.value,n=t.inputStates[a.name];if(!n)throw l(a.name);n.value=r;break}case u.NEW_VALUE:{t.formState.formStatus="DIRTY";const a=e.payload,r=a.value,n=t.inputStates[a.name];if(!n)throw l(a.name);n.value!==r&&(n._refreshValue=r,t.formState.refreshType===o.instant&&(t.formState.debounceNumber&&0!==t.formState.debounceNumber||(n.value=r)));break}case u.BLURRED:{const a=e.payload,r=t.inputStates[a.name];if(!r)throw l(a.name);r.value=r._refreshValue;break}case u.SET_SUCCESS:t.formState.formStatus="SUCCESS";break;case u.ASYNC_VALIDATION:if(e.payload.name){t.inputStates[e.payload.name].validateLoading=e.payload.value}break;default:throw new Error("Unexpected Action Type")}return t}class m{state;reducer;listeners=[];debounce;lastEvent={actionType:u.INIT,index:0};constructor(t,e){this.state=t,this.reducer=e,this.debounce=new c(t.formState.debounceNumber)}subscribe(t){return this.listeners.push(t),()=>{this.listeners.splice(this.listeners.indexOf(t),1)}}dispatch(t){this.lastEvent={actionType:t.type,index:this.lastEvent.index+1},this.state=this.reducer(this.state,t),t.type===u.NEW_VALUE&&this.state.formState.debounceNumber&&this.state.formState.debounceNumber>0?this.debounce?.cb((()=>{this.dispatch({type:u.NEW_FORCED_VALUE,payload:t.payload})})):this.broadcast()}getData(){let t={};const e=Object.keys(this.state.inputStates);for(let a=0;a<e.length;a++){const r=this.state.inputStates[e[a]];t[r.name]=r.value}return t}getValidationData(){let t={};const e=Object.keys(this.state.inputStates);for(let a=0;a<e.length;a++){const r=this.state.inputStates[e[a]];r.validateRequired&&(t[r.name]=r.value)}return t}checkInputExist(t){return!!this.state.inputStates[t]}getInputState(t){return this.state.inputStates[t]}createInput(t,e){return this.state.inputStates[t]={name:t,value:e.defaultValue,fragmentId:e.fragmentId,validateLoading:!1,_refreshValue:e.defaultValue,blurNumber:0,validateRequired:!1,validation:e.validation,error:null}}deleteInput(t){if(!this.state.inputStates[t])throw l(t);delete this.state.inputStates[t]}getFormState(){return this.state.formState}broadcast(){this.listeners.forEach((t=>t(this.state)))}getState(){return this.state}getDataByFragment(t){let e={};const a=Object.keys(this.state.inputStates);for(let r=0;r<a.length;r++){const n=this.state.inputStates[a[r]];n.fragmentId===t&&(e[n.name]=n.value)}return e}}const h=/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/im,p=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,f=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&/=]*)/;function g(t){return!!t}function S(t,e){let a=Number(t);return!isNaN(a)&&a>e}function y(t,e){return"string"==typeof t&&t.length>e}function E(t,e){let a=Number(t);return!isNaN(a)&&a<e}function _(t,e){return"string"==typeof t&&t.length<e}function v(t){return"string"==typeof t&&!!t.toLowerCase().match(p)}function R(t){return"string"==typeof t&&!!t.match(h)}function b(t,e){return t===e}function L(t){return"string"==typeof t&&!!t.match(f)}function N(t,e){return"string"==typeof t&&e.test(t)}var I;!function(t){t.required="required",t.min="min",t.minLength="minLength",t.max="max",t.maxLength="maxLength",t.email="email",t.phone="phone",t.repeatPassword="repeatPassword",t.url="url",t.regex="regex"}(I||(I={}));class A{store;validateName;validations={};constructor(t,e){this.store=t,this.validateName=e}required(){return this.register(I.required,g)}min(t){return this.register(I.min,S,t)}minLength(t){return this.register(I.minLength,y,t)}max(t){return this.register(I.max,E,t)}maxLength(t){return this.register(I.maxLength,_,t)}email(){return this.register(I.email,v)}phone(){return this.register(I.phone,R)}repeatPassword(t){const e=this.store.getData();return this.register(I.repeatPassword,b,e?e[t]:void 0)}url(){return this.register(I.url,L)}regex(t){return this.register(I.regex,N,t)}register(t,e,a){return this.validations[t]={fn:e,payload:a},this}registerAsync(t,e,a){return this.validations[t]={fn:e,payload:a},this}validate(t,e,a){return this.register("custom_"+this.validateName,e,Number(a))}async(t,e,a){return this.registerAsync("custom_"+this.validateName,e,Number(a))}}class O{store;confirmRequired=null;confirmPause=!1;fragmentNumber=0;constructor({refreshType:t=o.blur}){this.store=new m({formState:{formStatus:"CLEAN",formAttemptGlobalError:0,formAttemptError:0,error:null,readyToSubmit:!1,confirmed:!1,loading:!1,debounceNumber:0,refreshType:t},inputStates:{}},d),this.onSubmit=this.onSubmit.bind(this)}getStore(){return this.store}onSubmit(t){if(this.confirmPause)return;const e=this.store.getData(),a=this.validate(e);if(this.store.getFormState().loading&&console.warn("Double click detect"),a)for(let t=0;t<a.length;t++){const e=a[t];this.store.dispatch({type:u.SET_INPUT_ERROR,payload:{value:e.value,name:e.name,payload:e.payload,type:e.type}})}else try{this.store.dispatch({type:u.CLEAR_GLOBAL_ERROR});const a=t(e,{confirm:t=>{this.confirmRequired=t,this.confirmPause=!0,this.store.broadcast()}});if(a&&void 0!==a.then){this.store.dispatch({type:u.SET_LOADING_ON});a.catch((t=>{this.store.dispatch({type:u.SET_GLOBAL_ERROR,payload:t})})).then((()=>{this.store.dispatch({type:u.SET_SUCCESS})})).finally((()=>{this.store.dispatch({type:u.SET_LOADING_OFF})}))}}catch(t){this.store.dispatch({type:u.SET_GLOBAL_ERROR,payload:{type:"global",payload:t}})}}createInput(t,e){const a=this.store.createInput(t,e),r=this.store.getFormState();return{onChange:async e=>{if(this.store.dispatch({type:u.NEW_VALUE,payload:{value:e,name:t}}),r.refreshType===o.instant){const r=await this.validateInput(t,e);this.dispatchError(e,a,r)}},onBlur:async()=>{if(this.store.dispatch({type:u.BLURRED,payload:{name:t}}),r.refreshType===o.blur){const e=this.store.getInputState(t)?.value,r=await this.validateInput(t,e);this.dispatchError(e,a,r)}}}}deleteInput(t){this.store.deleteInput(t)}async validateInput(t,e){const a=this.store.getInputState(t);if(!a||!a?.validation)return null;const r=(0,a.validation)(new A(this.store,"validator_"+t)),n=Object.keys(r.validations);for(let s=0;s<n.length;s++){const i=n[s],o=r.validations[i],l=o.fn(e,o.payload);if(!l)return{name:t,type:i,value:e,payload:o.payload};if(l&&l.then){this.store.dispatch({type:u.ASYNC_VALIDATION,payload:{name:a.name,value:!0}});if(!await l)return{name:t,type:i,value:e,payload:o.payload}}}}validateFragment(t,e){const a=this.store.getDataByFragment(t),r=this.validate(a);if(r&&0!==r.length)for(let t=0;t<r.length;t++){const e=r[t];this.store.dispatch({type:u.SET_INPUT_ERROR,payload:{value:e.value,name:e.name,payload:e.payload,type:e.type}})}else e&&e()}validate(t){const e=[],a=Object.keys(t);for(let r=0;r<a.length;r++){const n=a[r],s=this.store.getInputState(n);if(!s||!s?.validation)continue;const i=s?.validation,o=i(new A(this.store,"validator_"+n)),u=Object.keys(o.validations);for(let a=0;a<u.length;a++){const r=u[a],s=o.validations[r];if(!s.fn(t[n],s.payload)){e.push({name:n,type:r,value:t[n],payload:s.payload});break}}}return e}dispatchError(t,e,a){a?this.store.dispatch({type:u.SET_INPUT_ERROR,payload:{value:t,name:e.name,payload:a.payload,type:a.type}}):e.error&&!a&&this.store.dispatch({type:u.CLEAN_INPUT_ERROR,payload:{value:t,name:e.name}}),e.validateLoading&&this.store.dispatch({type:u.ASYNC_VALIDATION,payload:{name:e.name,value:!1}})}getData(){return this.getStore().getData()}confirm(t){this.confirmPause=!1,this.confirmRequired&&this.confirmRequired(t),this.store.broadcast()}confirmCancel(){this.confirmPause=!1,this.confirmRequired=null,this.store.broadcast()}getFragmentNumber(){const t=this.fragmentNumber;return this.fragmentNumber++,t}}function T(t,r){const[n,s]=e((()=>t.getStore().getInputState(r)?.error)),[i,o]=e((()=>t.getStore().getInputState(r)?.validateLoading));return a((()=>{const e=t.getStore().getInputState(r);s(e?.error),o(e?.validateLoading)}),[t,r]),a((()=>t.getStore().subscribe((()=>{const e=t.getStore().getInputState(r);s(e?.error),o(e?.validateLoading)}))),[t,r]),{error:n,loading:i}}function C(t){const[r,n]=e((()=>t.getStore().getFormState()?.error));return a((()=>{n(t.getStore().getFormState()?.error)}),[t]),a((()=>t.getStore().subscribe((()=>{const e=t.getStore().getFormState();n(e?.error)}))),[t]),r}function w(t){const[r,n]=e((()=>t.getStore().getFormState()?.loading));return a((()=>{n(t.getStore().getFormState()?.loading)}),[t]),a((()=>t.getStore().subscribe((t=>{n(t.formState.loading)}))),[t]),r}function B(t){const[r,n]=e((()=>t.getStore().getState()));return a((()=>t.getStore().subscribe((t=>{n({...t})}))),[t]),r}function D(t,r){const[n,s]=e((()=>t.getStore().getInputState(r)?.value));return a((()=>{s(t.getStore().getInputState(r)?.value)}),[t,r]),a((()=>t.getStore().subscribe((t=>{s(t.inputStates[r]?.value)}))),[t,r]),n}function U(t,e,a){const s=r((()=>t.createInput(e,{defaultValue:a.defaultValue,validation:a.validation,fragmentId:a.fragmentId})),[t,a.defaultValue,a.validation,a.fragmentId]);return n((()=>()=>t.deleteInput(e)),[t,e]),s}const F=s(null);function V(e){const a=r((()=>e.formBase?e.formBase:new O({refreshType:e.refreshType})),[]);return t.createElement(F.Provider,{value:{formBase:a}},e.children)}function x(){const t=i(F);if(!t)throw new Error(`You cannot use ${"useContextFormBase"} outside of Form Component`);return t.formBase}function P(e){const a=x(),r=w(a);return t.createElement("form",{...e,onSubmit:t=>{t.preventDefault(),r||a.onSubmit(e.onSubmit)}})}function G(e){const{refreshType:a,formBase:r,...n}=e;return t.createElement(V,{formBase:r,refreshType:a},t.createElement(P,{...n},e.children))}const k=s(null);function q(){const t=i(k);return t?t.id:null}function W(e){const{name:a,validation:r,defaultValue:n,...s}=e,i=x(),o=q(),{onChange:u,onBlur:l}=U(i,a,{defaultValue:n,fragmentId:o,validation:r});return t.createElement("input",{...s,name:a,onChange:t=>{const e=t.target.value;u(e),s.onChange&&s.onChange(t)},onBlur:t=>{l(),s.onBlur&&s.onBlur(t)}})}function j(e){const{name:a,defaultValue:r,validation:s,...i}=e,o=x(),u=q(),{onChange:l,onBlur:c}=U(o,a,{defaultValue:r,fragmentId:u,validation:s});return n((()=>()=>o.deleteInput(a)),[o,a]),t.createElement("textarea",{...i,name:a,onChange:t=>{const e=t.target.value;l(e),i.onChange&&i.onChange(t)},onBlur:t=>{c(),i.onBlur&&i.onBlur(t)}})}function Y({errorMessage:e="Something went wrong"}){return C(x())?t.createElement("p",null,e):null}function z({name:e}){const a=x(),{error:r,loading:n}=T(a,e);return t.createElement("p",null,r?function(t){switch(t.type){case I.required:return"This Field is required.";case I.min:return"Minimum required number is "+t.payload;case I.minLength:return"Minimum "+t.payload+" "+(1===t.payload?"character":"characters")+" are allowed";case I.max:return"Maximum required number is "+t.payload;case I.maxLength:return"Maximum "+t.payload+" "+(1===t.payload?"character":"characters")+" are allowed";case I.email:return"Please enter a valid email address.";case I.phone:return"Please enter a valid phone number.";case I.repeatPassword:return(t&&t.name?t.name:"Password ")+" is not matched.";case I.url:return"Please enter a valid url."}return t.payload?.message||"Invalid field"}(r):null,n?t.createElement("span",null,"Loading"):null)}export{Y as ErrorForGlobal,z as ErrorForInput,G as Form,o as FormRefreshType,W as Input,j as Textarea,C as useErrorForGlobal,T as useErrorForInput,U as useInput,w as useLoading,B as useStoreStateWatch,D as useWatch};
//# sourceMappingURL=index.esm.js.map
